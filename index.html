<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>911 Dispatch Monitor</title>

<style>
:root {
    --bg:#000;
    --text:#fff;
    --accent:#00ffc0;
    --alert:#ff4444;
    --shift:#00ff88;
}

body {
    margin:0;
    font-family:Consolas,monospace;
    background:var(--bg);
    color:var(--text);
    overflow:hidden;
}

/* BUTTONS */
#fullscreen-btn,#settings-btn{
    position:fixed;
    top:10px;
    padding:8px 14px;
    background:var(--accent);
    border:none;
    cursor:pointer;
    font-weight:bold;
    z-index:9999;
}

#fullscreen-btn{left:10px;}
#settings-btn{right:10px;}

/* SETTINGS PANEL */
#settings-panel{
    position:fixed;
    top:60px;
    right:10px;
    background:#000;
    border:2px solid var(--accent);
    padding:15px;
    border-radius:10px;
    display:none;
    z-index:9999;
    width:220px;
}

#settings-panel label{
    display:block;
    margin:10px 0;
}

#settings-panel button{
    width:100%;
    margin-top:8px;
    padding:6px;
    background:var(--accent);
    border:none;
    cursor:pointer;
}

/* BANNERS */
#emergency-banner{
    position:fixed;
    bottom:0;
    width:100%;
    background:red;
    color:black;
    text-align:center;
    font-size:1.8vw;
    font-weight:bold;
    padding:8px;
    display:none;
    animation:flash 1s infinite;
}

body.emergency #emergency-banner{display:block;}

@keyframes flash{50%{opacity:.4;}}

#midnight-banner{
    position:fixed;
    top:30%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#ff00ff;
    color:#fff;
    font-size:3vw;
    font-weight:bold;
    padding:30px 50px;
    border:4px solid #fff;
    border-radius:20px;
    display:none;
    z-index:9999;
    animation:flashMidnight 1s infinite;
}

@keyframes flashMidnight{
    50%{opacity:.2;}
}

/* DASHBOARD */
#dashboard{
    display:grid;
    grid-template-columns:50% 50%;
    height:100vh;
}

#left-panel{
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
    border-right:2px solid var(--accent);
}

#clock-time{
    font-size:clamp(3rem,6vw,7rem);
    letter-spacing:.15em;
    text-shadow:0 0 25px var(--accent);
}

#clock-ms{color:#aaa;}

#clock-date{
    margin-top:15px;
    font-size:1.5vw;
    color:var(--accent);
}

/* SHIFT */
#shift-box{
    margin-top:20px;
    width:90%;
    padding:15px;
    border:2px solid var(--shift);
    border-radius:10px;
    text-align:center;
}

#shift-title{color:var(--shift);}

/* CALENDAR */
#calendar-box{
    margin-top:20px;
    width:90%;
    height:400px;
    border:2px solid var(--accent);
    border-radius:10px;
    background:rgba(0,255,192,.05);
    display:flex;
    flex-direction:column;
}

#calendar-iframe{
    width:100%;
    height:100%;
    border:0;
    filter:invert(1) hue-rotate(180deg) brightness(.85);
}

/* WARNINGS */
#warnings-panel{padding:35px;}

#warnings-title{
    font-size:2.2vw;
    color:var(--alert);
}

#warnings-list{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
    gap:18px;
}

.warning-card{
    border:2px solid;
    border-radius:10px;
    padding:14px;
    background:rgba(255,255,255,.04);
}

.tornado{border-color:red;box-shadow:0 0 18px red;}
.severe{border-color:orange;}
.winter{border-color:#66ccff;}
.flood{border-color:purple;}

/* SCROLL BAR */
#scrolling-bar{
    position:fixed;
    bottom:0;
    width:100%;
    height:40px;
    background:rgba(0,0,0,.85);
    border-top:2px solid var(--accent);
}

#scrolling-text{
    white-space:nowrap;
    display:inline-block;
    padding-left:100%;
    animation:scroll-left 30s linear infinite;
    font-size:1.5vw;
    color:var(--accent);
}

@keyframes scroll-left{
    to{transform:translateX(-100%);}
}
</style>
</head>

<body>

<button id="fullscreen-btn">FULLSCREEN</button>
<button id="settings-btn">‚öô SETTINGS</button>

<div id="settings-panel">
<label>
<input type="checkbox" id="alarm-toggle"> Enable Alarm
</label>

<label>
Volume:
<input type="range" id="volume" min="0" max="1" step="0.05">
</label>

<button id="test-alarm">üîî Test Alarm</button>
</div>

<div id="emergency-banner">‚ö†Ô∏è EMERGENCY MODE ACTIVE ‚ö†Ô∏è</div>
<div id="midnight-banner">üé∏ ROCKSTAR TIME! üé∏</div>

<div id="dashboard">

<div id="left-panel">

<div>
<span id="clock-time">00:00:00</span>
<span id="clock-ms">.000</span>
</div>

<div id="clock-date"></div>

<div id="shift-box">
<div id="shift-title">SHIFT TIMER</div>
<div id="shift-time"></div>
<div id="shift-status"></div>
</div>

<div id="calendar-box">
<iframe id="calendar-iframe"></iframe>
</div>

</div>

<div id="warnings-panel">

<div id="warnings-title">Nebraska Active Warnings</div>
<div id="warnings-list">Loading...</div>

</div>

</div>

<div id="scrolling-bar">
<div id="scrolling-text"></div>
</div>

<script>

/* ELEMENTS */
const fsBtn=document.getElementById("fullscreen-btn");
const settingsBtn=document.getElementById("settings-btn");
const panel=document.getElementById("settings-panel");

const alarmToggle=document.getElementById("alarm-toggle");
const volume=document.getElementById("volume");
const testBtn=document.getElementById("test-alarm");

const midnightBanner=document.getElementById("midnight-banner");

/* FULLSCREEN + SOUND UNLOCK */
let alarm=new Audio("https://www.soundjay.com/button/beep-07.wav");
let soundUnlocked=false;

fsBtn.onclick=()=>{

  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }

  if(!soundUnlocked){
    alarm.play().then(()=>{
      alarm.pause();
      alarm.currentTime=0;
      soundUnlocked=true;
    }).catch(()=>{});
  }
};

/* SETTINGS */
settingsBtn.onclick=()=>{
  panel.style.display=
    panel.style.display==="block"?"none":"block";
};

/* LOAD SAVED */
alarmToggle.checked=
  localStorage.getItem("alarm")!=="off";

volume.value=
  localStorage.getItem("volume")||0.7;

alarm.volume=volume.value;

/* SAVE */
alarmToggle.onchange=()=>{
  localStorage.setItem("alarm",
    alarmToggle.checked?"on":"off");
};

volume.oninput=()=>{
  alarm.volume=volume.value;
  localStorage.setItem("volume",volume.value);
};

/* TEST */
testBtn.onclick=()=>{

  if(!soundUnlocked){
    alert("Click FULLSCREEN first");
    return;
  }

  alarm.loop=true;
  alarm.play();

  midnightBanner.style.display="block";

  setTimeout(stopAlarm,5000);
};

function stopAlarm(){

  alarm.pause();
  alarm.currentTime=0;
  alarm.loop=false;

  midnightBanner.style.display="none";
}

/* CLOCK */
function pad(n){return String(n).padStart(2,"0");}

setInterval(()=>{

  const n=new Date();

  document.getElementById("clock-time").textContent=
    `${pad(n.getHours())}:${pad(n.getMinutes())}:${pad(n.getSeconds())}`;

  document.getElementById("clock-ms").textContent=
    "."+String(n.getMilliseconds()).padStart(3,"0");

  document.getElementById("clock-date").textContent=
    n.toLocaleDateString("en-US",
    {weekday:"long",month:"long",day:"numeric"});

},50);

/* SHIFT */
const START="17:30",END="05:30";

setInterval(()=>{

  const now=new Date();

  let [sh,sm]=START.split(":").map(Number);
  let [eh,em]=END.split(":").map(Number);

  let s=new Date(now),e=new Date(now);

  s.setHours(sh,sm,0,0);
  e.setHours(eh,em,0,0);

  if(e<=s){
    if(now<e) s.setDate(s.getDate()-1);
    else e.setDate(e.getDate()+1);
  }

  let t,status;

  if(now>=s && now<=e){
    t=e-now; status="ON SHIFT";
  }else{
    let n=new Date(s);
    if(now>e) n.setDate(n.getDate()+1);
    t=n-now; status="UNTIL SHIFT";
  }

  document.getElementById("shift-time").textContent=
    `${pad(t/3600000|0)}:${pad(t/60000%60|0)}:${pad(t/1000%60|0)}`;

  document.getElementById("shift-status").textContent=status;

},1000);

/* WARNINGS */
async function loadWarnings(){

  try{

    const r=await fetch("https://api.weather.gov/alerts/active?area=NE");

    const d=await r.json();

    let h="",em=false;

    d.features.slice(0,6).forEach(a=>{

      let e=a.properties.event.toLowerCase();
      let c="";

      if(e.includes("tornado")){c="tornado";em=true;}
      else if(e.includes("severe"))c="severe";
      else if(e.includes("winter"))c="winter";
      else if(e.includes("flood"))c="flood";

      h+=`<div class="warning-card ${c}">
      <b>${a.properties.event}</b><br>
      ${a.properties.headline}
      </div>`;
    });

    document.getElementById("warnings-list").innerHTML=
      h||"No Active Alerts";

    document.body.classList.toggle("emergency",em);

  }catch{
    document.getElementById("warnings-list").textContent="API Offline";
  }
}

loadWarnings();
setInterval(loadWarnings,300000);

/* CALENDAR */
document.getElementById("calendar-iframe").src=
"https://calendar.google.com/calendar/embed?src=beatrice.ne.gov_ne4nvf6ctq87f6pqvfkn7bgof8%40group.calendar.google.com&ctz=America%2FChicago&mode=AGENDA&showTitle=0&showNav=0&showTabs=0";

/* SCROLL */
const traffic=[
"I-80 Westbound: heavy congestion near Lincoln.",
"Beatrice Main St: construction delays downtown.",
"Highway 77: accident cleared."
];

function scroll(){

  document.getElementById("scrolling-text").textContent=
  traffic.join(" ‚ö´ ");

}

scroll();
setInterval(scroll,300000);

/* MIDNIGHT (SAFE) */
let lastDay="";

setInterval(()=>{

  if(!alarmToggle.checked) return;
  if(!soundUnlocked) return;

  const n=new Date();
  const d=n.toDateString();

  if(n.getHours()===0 && n.getMinutes()===0 && d!==lastDay){

    lastDay=d;

    alarm.loop=true;
    alarm.play();

    midnightBanner.style.display="block";

    setTimeout(stopAlarm,60000);
  }

},1000);

</script>
</body>
</html>
