<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>911 Dispatch Monitor</title>

<!-- STYLES -->
<style>
:root {
    --bg: #000;
    --text: #fff;
    --accent: #00ffc0;
    --alert: #ff4444;
    --shift: #00ff88;
}

/* RESET & BODY */
* { box-sizing: border-box; }
html, body {
    margin: 0; padding: 0;
    width: 100%; height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: Consolas, monospace;
    overflow: hidden;
}

/* FULLSCREEN BUTTON */
#fullscreen-btn {
    position: fixed; top: 10px; left: 10px;
    z-index: 9999;
    padding: 8px 14px;
    background: var(--accent);
    border: none;
    font-weight: bold;
    cursor: pointer;
}

/* EMERGENCY BANNER */
body.emergency { background: #200000; }
#emergency-banner {
    position: fixed; bottom: 0; width: 100%;
    background: red; color: black;
    text-align: center; font-size: 1.8vw;
    font-weight: bold; padding: 8px;
    display: none; animation: flash 1s infinite;
}
body.emergency #emergency-banner { display: block; }
@keyframes flash { 50% { opacity: .4; } }

/* MAIN GRID */
#dashboard {
    display: grid;
    grid-template-columns: 50% 50%;
    height: 100%;
}

/* LEFT PANEL */
#left-panel {
    display: flex; flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    border-right: 2px solid var(--accent);
    padding: 20px;
    overflow: hidden;
}

/* CLOCK PANEL */
#clock-panel {
    text-align: center;
}
#clock-time {
    font-size: clamp(3rem, 6vw, 7rem);
    letter-spacing: .15em;
    text-shadow: 0 0 25px var(--accent);
}
#clock-ms { font-size: 1.4vw; color: #aaa; }
#clock-date { margin-top: 15px; font-size: 1.5vw; color: var(--accent); }

/* SHIFT TIMER */
#shift-box {
    margin-top: 20px;
    width: 90%;
    padding: 15px;
    border: 2px solid var(--shift);
    border-radius: 10px;
    text-align: center;
}
#shift-title { color: var(--shift); margin-bottom: 5px; }
#shift-time { font-size: 2.2vw; }
#shift-status { color: #aaa; }

/* CALENDAR PANEL */
#calendar-box {
    margin-top: 20px;
    width: 90%; height: 400px;
    border: 2px solid var(--accent);
    border-radius: 10px;
    background: rgba(0,255,192,0.05);
    overflow: hidden;
    display: flex; flex-direction: column;
}
#calendar-title { color: var(--accent); margin-bottom: 5px; font-size: 1.5vw; }
#calendar-iframe {
    width: 100%; height: 100%; border: 0;
    border-radius: 10px;
    filter: invert(1) hue-rotate(180deg) brightness(0.85);
}

/* WARNINGS PANEL */
#warnings-panel {
    padding: 35px; position: relative; overflow: hidden;
}
#warnings-title { font-size: 2.2vw; color: var(--alert); margin-bottom: 10px; }
#warnings-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 18px;
}
.warning-card {
    border: 2px solid; border-radius: 10px;
    padding: 14px;
    background: rgba(255,255,255,.04);
}
.tornado { border-color: red; box-shadow: 0 0 18px red; animation: flash 1s infinite; }
.severe { border-color: orange; box-shadow: 0 0 14px orange; }
.winter { border-color: #66ccff; box-shadow: 0 0 14px #66ccff; }
.flood { border-color: purple; box-shadow: 0 0 14px purple; }

/* SCROLLING INFO BAR */
#scrolling-bar {
    position: fixed; bottom: 0; width: 100%; height: 40px;
    background: rgba(0,0,0,0.85); border-top: 2px solid var(--accent);
    overflow: hidden; z-index: 999;
}
#scrolling-text {
    white-space: nowrap;
    display: inline-block;
    padding-left: 100%;
    animation: scroll-left 30s linear infinite;
    font-size: 1.5vw; color: var(--accent);
}
@keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
</style>
</head>

<body>
<!-- FULLSCREEN -->
<button id="fullscreen-btn">FULLSCREEN</button>

<!-- EMERGENCY ALERT -->
<div id="emergency-banner">⚠️ EMERGENCY MODE ACTIVE ⚠️</div>

<!-- MAIN DASHBOARD -->
<div id="dashboard">

    <!-- LEFT PANEL -->
    <div id="left-panel">
        <!-- CLOCK -->
        <div id="clock-panel">
            <div>
                <span id="clock-time">00:00:00</span>
                <span id="clock-ms">.000</span>
            </div>
            <div id="clock-date">-- Day, Month 00 --</div>
        </div>

        <!-- SHIFT TIMER -->
        <div id="shift-box">
            <div id="shift-title">SHIFT TIMER</div>
            <div id="shift-time">--:--:--</div>
            <div id="shift-status">LOADING</div>
        </div>

        <!-- CALENDAR -->
        <div id="calendar-box">
            <div id="calendar-title">Upcoming Calendar Events</div>
            <iframe id="calendar-iframe" src="about:blank" scrolling="no"></iframe>
        </div>
    </div>

    <!-- WARNINGS PANEL -->
    <div id="warnings-panel">
        <div id="warnings-title">Nebraska Active Warnings</div>
        <div id="warnings-list">Loading alerts...</div>
    </div>

</div>

<!-- SCROLLING INFO BAR -->
<div id="scrolling-bar">
    <div id="scrolling-text">Loading updates...</div>
</div>

<!-- AUDIO ALERTS -->
<audio id="tornado-audio"><source src="data:audio/wav;base64,..."></audio>
<audio id="severe-audio"><source src="data:audio/wav;base64,..."></audio>

<script>
/* -------------------- ELEMENTS -------------------- */
const fsBtn = document.getElementById("fullscreen-btn");
const clockTime = document.getElementById("clock-time");
const clockMs = document.getElementById("clock-ms");
const clockDate = document.getElementById("clock-date");
const shiftTime = document.getElementById("shift-time");
const shiftStatus = document.getElementById("shift-status");
const warningsList = document.getElementById("warnings-list");
const calendarIframe = document.getElementById("calendar-iframe");
const tornadoAudio = document.getElementById("tornado-audio");
const severeAudio = document.getElementById("severe-audio");
const scrollingText = document.getElementById("scrolling-text");

/* -------------------- FULLSCREEN -------------------- */
fsBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(() => {});
    else document.exitFullscreen();
});

/* -------------------- CLOCK -------------------- */
function pad(n){ return String(Math.floor(n)).padStart(2,"0"); }
function updateClock(){
    const now = new Date();
    const h = pad(now.getHours()), m = pad(now.getMinutes()), s = pad(now.getSeconds()), ms = String(now.getMilliseconds()).padStart(3,"0");
    clockTime.textContent = `${h}:${m}:${s}`;
    clockMs.textContent = "." + ms;
    clockDate.textContent = now.toLocaleDateString("en-US", {weekday:"long", month:"long", day:"numeric"});
}
setInterval(updateClock, 50); updateClock();

/* -------------------- SHIFT TIMER -------------------- */
const SHIFT_START = "17:30", SHIFT_END = "05:30";
function updateShift(){
    const now = new Date();
    let [sh,sm] = SHIFT_START.split(":").map(Number);
    let [eh,em] = SHIFT_END.split(":").map(Number);
    let start = new Date(now); start.setHours(sh, sm, 0, 0);
    let end = new Date(now); end.setHours(eh, em, 0, 0);
    if(end <= start){ if(now < end) start.setDate(start.getDate()-1); else end.setDate(end.getDate()+1);}
    if(now>=start && now<=end){
        let r=end-now;
        shiftTime.textContent=`${pad(r/3600000)}:${pad(r/60000%60)}:${pad(r/1000%60)}`;
        shiftStatus.textContent="ON SHIFT";
    }else{
        let next = new Date(start); if(now>end) next.setDate(next.getDate()+1);
        let r=next-now;
        shiftTime.textContent=`${pad(r/3600000)}:${pad(r/60000%60)}:${pad(r/1000%60)}`;
        shiftStatus.textContent="UNTIL SHIFT";
    }
}
setInterval(updateShift,1000); updateShift();

/* -------------------- WARNINGS -------------------- */
let previousAlerts=[];
async function loadWarnings(){
    try{
        const res = await fetch("https://api.weather.gov/alerts/active?area=NE",{headers:{"User-Agent":"dispatch-monitor"}});
        if(!res.ok) throw new Error("API");
        const data = await res.json();
        document.body.classList.remove("emergency");
        if(!data.features || data.features.length===0){warningsList.innerHTML="<div>No Active Alerts</div>"; previousAlerts=[]; return;}
        let html="", emergency=false;
        data.features.slice(0,6).forEach(a=>{
            const p = a.properties;
            let cls="", e = p.event.toLowerCase();
            if(e.includes("tornado")){ cls="tornado"; emergency=true; if(!previousAlerts.includes(p.id)) tornadoAudio.play();}
            else if(e.includes("severe")){ cls="severe"; if(!previousAlerts.includes(p.id)) severeAudio.play();}
            else if(e.includes("winter")||e.includes("blizzard")) cls="winter";
            else if(e.includes("flood")) cls="flood";
            html+=`<div class="warning-card ${cls}"><strong>${p.event}</strong><br>${p.headline}<br><span style="color:var(--accent)">Until: ${new Date(p.expires).toLocaleString()}</span></div>`;
        });
        warningsList.innerHTML = html;
        if(emergency) document.body.classList.add("emergency");
        previousAlerts = data.features.map(f=>f.id);
    }catch(err){
        warningsList.innerHTML="<div style='color:red'>Weather API Offline</div>";
        console.log(err);
    }
}
loadWarnings(); setInterval(loadWarnings, 300000);

/* -------------------- CALENDAR -------------------- */
calendarIframe.src = "https://calendar.google.com/calendar/embed?src=beatrice.ne.gov_ne4nvf6ctq87f6pqvfkn7bgof8%40group.calendar.google.com&ctz=America%2FChicago&mode=AGENDA&bgcolor=%23000000&color=%2300ff00&showTitle=0&showNav=0&showTabs=0&showCalendars=0&showTz=0";

/* -------------------- SCROLLING INFO BAR -------------------- */
const NEWS_API_KEY = "YOUR_NEWSAPI_KEY";
const NEWS_API_URL = `https://newsapi.org/v2/top-headlines?country=us&category=general&pageSize=5&apiKey=${NEWS_API_KEY}`;
const trafficUpdates = [
    "I-80 Westbound: heavy congestion near Lincoln.",
    "Beatrice Main St: construction delays downtown.",
    "Highway 77: accident cleared, traffic flowing normally."
];
async function updateScrollingText(){
    let newsText = "";
    try{
        const res = await fetch(NEWS_API_URL);
        if(res.ok){
            const data = await res.json();
            newsText = data.articles?.length>0 ? data.articles.map(a=>a.title).join(" ⚫ ") : "No news updates ⚫ ";
        } else newsText="Unable to fetch news ⚫ ";
    }catch(e){ newsText="News API error ⚫ "; }

    scrollingText.textContent = [...trafficUpdates, newsText].join(" ⚫ ");
    scrollingText.style.animation="none"; void scrollingText.offsetWidth; scrollingText.style.animation="scroll-left 30s linear infinite";
}
updateScrollingText();
setInterval(updateScrollingText, 300000);
</script>
</body>
</html>
